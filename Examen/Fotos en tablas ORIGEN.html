<!doctype html>
<html>
<head>
   <meta charset="UTF-8" meta charset="UTF-8">
   <title> Examen con fotos y tablas </title>

   <style>
		.ocultar{
			display: none;
		}

	   .fotos { /* defino una clase para cambiar el tamaño de las fotos */
	   		width: 100px;
	   		height: 100px;
		}

	   .amplia { /* defino una clase para cambiar el tamaño de las fotos ampliadas*/
	   		width: 500px;
	   		height: 500px;
		}

		.recolocar{   /* defino una clase para recolocar el div de la foto ampliada */
			position: fixed;
			top: 50px;
			right: 30px;
		}

        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
        }

   </style>


   <script type="text/javascript">
	
	
	let listaFotos=[
		{
			"nombre": "FB_IMG_1685577146004",
			"tipo": "jpg",
			"tamanno": "95.477",
			"tematica": ["Web","Programacion"]
		},
		{
			"nombre": "FB_IMG_1676156609518",
			"tipo": "jpg",
			"tamanno": "22.089",
			"tematica": "Programacion"
		},
				{
			"nombre": "FB_IMG_1667318456231",
			"tipo": "jpg",
			"tamanno": "83.212",
			"tematica": "Programacion"
		},
		{
			"nombre": "FB_IMG_1678917723620",
			"tipo": "jpg",
			"tamanno": "45.624",
			"tematica": ["Web", "programacion"]
		},
		{
			"nombre": "FB_IMG_1699051552872",
			"tipo": "jpg",
			"tamanno": "63.303",
			"tematica": "Programacion"
		},
			{
			"nombre": "FB_IMG_1645211597935",
			"tipo": "jpg",
			"tamanno": "74.104",
			"tematica": ["Web", "programacion"]
		}
	];


	


		
	


   </script>
</head>

<body>
	<div id="destino"> </div> <!-- Aquí pondré la tabla -->					
	</div>

	<div id="ampliada"> </div> <!-- Aquí pondré las fotos ampliadas que saldrán en el lado derecho -->					
	</div>

	<br/>
	<br/>
	<input type="button" value="Enviar al servidor las seleccionadas" name="boton">

	<br/>
	<br/>
	<p id="p"> Pulsa F1 para ordenar por nombre las fotos </p>

	<dialog id="size" style="position:absolute; margin:0;"></dialog> <!-- Diálogo que mostrará el tamaño de la foto al pasar el ratón por encima -->

    <script>
        const divTabla = document.getElementById("destino");
        const divImagen = document.getElementById("ampliada");

        const dialog = document.createElement("dialog");
        document.getElementsByTagName("body")[0].appendChild(dialog);

        const tabla = document.createElement("table");
        function mostrarImagenes() {
            if (tabla.innerHTML !== "") {
                tabla.innerHTML = "";
            }
            tabla.innerHTML = `<tr><th>Fotos disponibles</th></tr>`;
            for (const elemento of listaFotos) {
                tabla.innerHTML += `
                    <tr>
                        <td><img src="./assets/${elemento.nombre}.${elemento.tipo}" class="fotos"></td>
                        <td class="tamanno">${elemento.nombre}</td>
                        <td><input type="checkbox" name="btnEnviar" class="btnEnviar">Enviar</td>
                    </tr>`;
            }
            divTabla.appendChild(tabla);

            const nombres = document.getElementsByClassName("tamanno");
            for (let i = 0; i < nombres.length; i++) {
                nombres[i].addEventListener("mouseenter", (event)=> {
                    dialog.innerHTML = `${listaFotos[i].tamanno}`;
                    dialog.style.left = `${event.left}px`;
                    dialog.style.top = `${event.top}px`;
                    dialog.showModal();
                })
                nombres[i].addEventListener("mouseleave", ()=> {
                    dialog.close();
                })
            }
            
            const imagenesTabla = document.getElementsByClassName("fotos");
            for (let i = 0; i < imagenesTabla.length - 1; i++) {
                imagenesTabla[i].addEventListener("click", () => {
                    const imagenAmpliada = imagenesTabla[i];
                    imagenAmpliada.classList.add("amplia");
                    imagenAmpliada.classList.add("recolocar");
                    divImagen.appendChild(imagenAmpliada);
                    mostrarImagenes();
                    setTimeout(() => {
                        imagenAmpliada.classList.add("ocultar");
                    }, 3000)
                })
            }
        }

        function ordenarFotos() {
            listaFotos.sort((a, b) => {
                const fotoA = a.nombre;
                const fotoB = b.nombre;
                if (fotoA < fotoB) {
                    return -1;
                }
                if (fotoA > fotoB) {
                    return 1;
                }

                return 0;
            });
            mostrarImagenes();
        }

        mostrarImagenes();

        document.addEventListener("keypress", (event) => {
            // Con las teclas F no se o no me funciona, con cualquier otra si
            if (event.key === "F1") {
                preventDefault();
                ordenarFotos();
            }
            if (event.key === "a") {
                ordenarFotos();
            }
        });

        const btnEnviar = document.getElementsByTagName("input")[6];
        btnEnviar.addEventListener("click", () => {
            const botones = document.getElementsByClassName("btnEnviar");
            const tamanno = botones.length;
            for (let i = 0; i < tamanno; i++) {
                if (botones[i].checked) {
                    const objetoFoto = { "nombre": `${listaFotos[i].nombre}.${listaFotos[i].tipo}` }
                    fetch("http://localhost:3000/datosFotos", {
                        method: "POST",
                        body: JSON.stringify(objetoFoto),
                        headers: {
                            "Content-Type": "application/json",
                        },
                    });
                    botones[i].checked = false;
                }
            }
        });

        document.addEventListener("click", (event)=> {
            if (event.target !== HTMLTableCellElement) {
                const texto = document.getElementById("p");
                texto.innerHTML= " No sirve de nada pulsar aqui "
                setTimeout(()=> {
                    texto.innerHTML= " Pulsa F1 para ordenar por nombre las fotos "
                }, 2000);
            }
        })
    </script>
</body>
</html>


